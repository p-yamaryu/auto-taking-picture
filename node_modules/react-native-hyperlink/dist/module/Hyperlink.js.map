{"version":3,"names":["React","Component","View","Text","Linking","Platform","mdurl","linkify","require","OS","Hyperlink","getDerivedStateFromProps","nextProps","prevState","linkifyIt","constructor","props","component","state","pretest","children","test","elements","_lastIndex","componentProps","ref","undefined","key","match","forEach","index","lastIndex","text","url","nonLinkedText","substring","push","linkText","clickHandlerProps","onLongPress","onPress","style","linkStyle","injectViewProps","length","cloneElement","err","Children","map","child","type","displayName","isTextNested","parse","render","linkDefault","viewProps","isValidElement","Error","_","handleLink","bind","urlObject","protocol","toLowerCase","normalizedURL","format","canOpenURL","then","supported","openURL"],"sources":["Hyperlink.tsx"],"sourcesContent":["import React, { Component } from 'react';\nimport { View, Text, Linking, Platform } from 'react-native';\nimport mdurl from 'mdurl';\nimport type {\n\tHyperlinkProps,\n\tHyperlinkState,\n\tReactElementWithType,\n} from './types';\n\nconst linkify = require('linkify-it')();\n\nconst { OS } = Platform;\n\nclass Hyperlink extends Component<HyperlinkProps, HyperlinkState> {\n\tpublic static defaultProps: Partial<HyperlinkProps> = {\n\t\tlinkify,\n\t\tinjectViewProps: _ => ({}),\n\t};\n\n\tpublic static getDerivedStateFromProps(\n\t\tnextProps: HyperlinkProps,\n\t\tprevState: HyperlinkState,\n\t): HyperlinkState | null {\n\t\treturn nextProps.linkify !== prevState.linkifyIt\n\t\t\t? { linkifyIt: nextProps.linkify || linkify }\n\t\t\t: null;\n\t}\n\n\tconstructor(props: HyperlinkProps) {\n\t\tsuper(props);\n\t\tthis.state = { linkifyIt: props.linkify || linkify };\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tonPress,\n\t\t\tlinkDefault,\n\t\t\tonLongPress,\n\t\t\tlinkStyle,\n\t\t\tlinkify,\n\t\t\tlinkText,\n\t\t\t...viewProps\n\t\t} = this.props;\n\n\t\treturn (\n\t\t\t<View\n\t\t\t\t{...viewProps}\n\t\t\t\tstyle={this.props.style}\n\t\t\t>\n\t\t\t\t{!this.props.onPress && !this.props.onLongPress && !this.props.linkStyle\n\t\t\t\t\t? this.props.children\n\t\t\t\t\t: //@ts-ignore\n\t\t\t\t\t  this.parse(this).props.children}\n\t\t\t</View>\n\t\t);\n\t}\n\n\tisTextNested(component: ReactElementWithType) {\n\t\tif (!React.isValidElement(component)) throw new Error('Invalid component');\n\t\tlet { type: { displayName } = {} } = component;\n\t\tif (displayName !== 'Text') throw new Error('Not a Text component');\n\t\treturn typeof component.props.children !== 'string';\n\t}\n\n\tlinkify = (component: ReactElementWithType) => {\n\t\tif (\n\t\t\t!this.state.linkifyIt.pretest(component.props.children) ||\n\t\t\t!this.state.linkifyIt.test(component.props.children)\n\t\t)\n\t\t\treturn component;\n\n\t\tlet elements = [];\n\t\tlet _lastIndex = 0;\n\n\t\tconst componentProps = {\n\t\t\t...component.props,\n\t\t\tref: undefined,\n\t\t\tkey: undefined,\n\t\t};\n\n\t\ttry {\n\t\t\tthis.state.linkifyIt\n\t\t\t\t.match(component.props.children)\n\t\t\t\t?.forEach(({ index, lastIndex, text, url }) => {\n\t\t\t\t\tlet nonLinkedText = component.props.children.substring(\n\t\t\t\t\t\t_lastIndex,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t);\n\t\t\t\t\tnonLinkedText && elements.push(nonLinkedText);\n\t\t\t\t\t_lastIndex = lastIndex;\n\t\t\t\t\tif (this.props.linkText)\n\t\t\t\t\t\ttext =\n\t\t\t\t\t\t\ttypeof this.props.linkText === 'function'\n\t\t\t\t\t\t\t\t? this.props.linkText(url)\n\t\t\t\t\t\t\t\t: this.props.linkText;\n\n\t\t\t\t\tconst clickHandlerProps: {\n\t\t\t\t\t\tonPress?: HyperlinkProps['onPress'];\n\t\t\t\t\t\tonLongPress?: HyperlinkProps['onLongPress'];\n\t\t\t\t\t} = {};\n\t\t\t\t\tif (OS !== 'web') {\n\t\t\t\t\t\tclickHandlerProps.onLongPress = this.props.onLongPress\n\t\t\t\t\t\t\t? () => this.props.onLongPress?.(url, text)\n\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\t}\n\t\t\t\t\tclickHandlerProps.onPress = this.props.onPress\n\t\t\t\t\t\t? () => this.props.onPress?.(url, text)\n\t\t\t\t\t\t: undefined;\n\n\t\t\t\t\telements.push(\n\t\t\t\t\t\t<Text\n\t\t\t\t\t\t\t{...componentProps}\n\t\t\t\t\t\t\t{...clickHandlerProps}\n\t\t\t\t\t\t\tkey={url + index}\n\t\t\t\t\t\t\tstyle={[component.props.style, this.props.linkStyle]}\n\t\t\t\t\t\t\t{...this.props.injectViewProps?.(url)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{text}\n\t\t\t\t\t\t</Text>,\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\telements.push(\n\t\t\t\tcomponent.props.children.substring(\n\t\t\t\t\t_lastIndex,\n\t\t\t\t\tcomponent.props.children.length,\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn React.cloneElement(component, componentProps, elements);\n\t\t} catch (err) {\n\t\t\treturn component;\n\t\t}\n\t};\n\n\tparse = (component: ReactElementWithType): ReactElementWithType => {\n\t\tlet { props: { children } = { children: undefined } } = component || {};\n\t\tif (!children) return component;\n\n\t\tconst componentProps = {\n\t\t\t...component.props,\n\t\t\tref: undefined,\n\t\t\tkey: undefined,\n\t\t};\n\n\t\treturn React.cloneElement(\n\t\t\tcomponent,\n\t\t\tcomponentProps,\n\t\t\tReact.Children.map(children, (child: ReactElementWithType) => {\n\t\t\t\tlet { type: { displayName } = { displayName: undefined } } =\n\t\t\t\t\tchild || {};\n\t\t\t\tif (typeof child === 'string' && this.state.linkifyIt.pretest(child))\n\t\t\t\t\treturn this.linkify(\n\t\t\t\t\t\t<Text\n\t\t\t\t\t\t\t{...componentProps}\n\t\t\t\t\t\t\tstyle={component.props.style}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{child}\n\t\t\t\t\t\t</Text>,\n\t\t\t\t\t);\n\t\t\t\tif (displayName === 'Text' && !this.isTextNested(child))\n\t\t\t\t\treturn this.linkify(child);\n\t\t\t\treturn this.parse(child);\n\t\t\t}),\n\t\t);\n\t};\n}\n\nexport default class extends Component<HyperlinkProps> {\n\tconstructor(props: HyperlinkProps) {\n\t\tsuper(props);\n\t\tthis.handleLink = this.handleLink.bind(this);\n\t}\n\n\thandleLink(url: string) {\n\t\tconst urlObject = mdurl.parse(url);\n\t\turlObject.protocol = urlObject.protocol.toLowerCase();\n\t\tconst normalizedURL = mdurl.format(urlObject);\n\n\t\tLinking.canOpenURL(normalizedURL).then(\n\t\t\tsupported => supported && Linking.openURL(normalizedURL),\n\t\t);\n\t}\n\n\trender() {\n\t\tconst onPress = this.handleLink || this.props.onPress;\n\t\treturn this.props.linkDefault ? (\n\t\t\t<Hyperlink\n\t\t\t\t{...this.props}\n\t\t\t\tonPress={onPress}\n\t\t\t/>\n\t\t) : (\n\t\t\t<Hyperlink {...this.props} />\n\t\t);\n\t}\n}\n"],"mappings":"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"}